<div class="container">
    <h1 class="p-text-center">EDF File Processor Results</h1>

    <div *ngIf="edfFiles$ | async as files; else loading">
        <p-table
                [value]="files"
                [paginator]="true"
                [rows]="5"
                [showCurrentPageReport]="true"
                currentPageReportTemplate="Showing {first} to {last} of {totalRecords} entries"
                [rowsPerPageOptions]="[5, 10, 25, 50]"
                styleClass="p-datatable-striped"
                [tableStyle]="{'min-width': '80rem'}">

            <ng-template pTemplate="caption">
                <i class="pi pi-list p-mr-2"></i>
                Processed EDF File Details
            </ng-template>

            <ng-template pTemplate="header">
                <tr>
                    <th pSortableColumn="fileName">File Name
                        <p-sortIcon field="fileName"></p-sortIcon>
                    </th>
                    <th pSortableColumn="patientName">Patient Name
                        <p-sortIcon field="patientName"></p-sortIcon>
                    </th>
                    <th pSortableColumn="identifier">Identifier
                        <p-sortIcon field="identifier"></p-sortIcon>
                    </th>
                    <th pSortableColumn="recordingDate">Recording Date
                        <p-sortIcon field="recordingDate"></p-sortIcon>
                    </th>
                    <th pSortableColumn="recordingLengthSeconds">Length (s)
                        <p-sortIcon field="recordingLengthSeconds"></p-sortIcon>
                    </th>
                    <th pSortableColumn="numberOfAnnotations">Annotations
                        <p-sortIcon field="numberOfAnnotations"></p-sortIcon>
                    </th>
                    <th>Channels</th>
                    <th>Status</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-file>
                <tr>
                    <td>{{ file.fileName }}</td>
                    <td>{{ file.patientName || 'N/A' }}</td>
                    <td>{{ file.identifier || 'N/A' }}</td>
                    <td>{{ file.recordingDate ? (file.recordingDate | date:'short') : 'N/A' }}</td>
                    <td>{{ file.recordingLengthSeconds ? (file.recordingLengthSeconds | number:'1.0-0') : 'N/A' }}</td>
                    <td>{{ file.numberOfAnnotations ?? 'N/A' }}</td>
                    <td>
                        <div *ngIf="file.valid">
                            <strong>{{ file.numberOfChannels }}</strong>:
                            <span class="channel-names">{{ file.channelLabels?.join(', ') }}</span>
                        </div>
                        <div *ngIf="!file.valid">N/A</div>
                    </td>
                    <td>
                        <p-tag
                                [value]="file.valid ? 'Valid' : 'Invalid'"
                                [severity]="file.valid ? 'success' : 'danger'">
                        </p-tag>
                        <div *ngIf="!file.valid" class="p-error p-mt-2 error-details">
                            {{ file.statusMessage }}
                        </div>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
                <tr>
                    <td colspan="8" class="p-text-center">No EDF files found.</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>

<ng-template #loading>
    <div class="container p-mt-4">
        <p-skeleton height="40px" styleClass="p-mb-2"></p-skeleton>
        <p-skeleton height="250px"></p-skeleton>
    </div>
</ng-template>